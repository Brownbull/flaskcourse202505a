{% extends 'dashboard/dash_nav.html' %}
{% block dashboard_content %}
<div class="py-6">
    <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
        <div class="sm:flex sm:items-center">
            <div class="sm:flex-auto">
                <h2 class="text-lg font-semibold text-gray-900 mb-4">Sessions</h2>
            </div>
            <div class="mt-4 sm:mt-0 sm:ml-16 sm:flex-none">
                <a href="{{ url_for('main.edit_session') }}"
                    class="block rounded-md bg-indigo-600 px-3 py-2 text-center text-sm font-semibold text-white shadow-xs hover:bg-indigo-500 focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600">
                    Add Session</a>
            </div>
        </div>
    </div>
    <div class="mt-6 overflow-x-auto">
    <form method="get" class="mb-4 flex gap-4 items-center">
        <div>
            <label for="doctor" class="text-xs font-medium text-gray-700">Medic:</label>
            <select name="doctor" id="doctor" class="ml-2 px-2 py-1 rounded border border-gray-300">
                <option value="">All</option>
                {% for d in doctor_list %}
                <option value="{{ d }}" {% if doctor == d %}selected{% endif %}>{{ d }}</option>
                {% endfor %}
            </select>
        </div>
        <div>
            <label for="patient" class="text-xs font-medium text-gray-700">Patient:</label>
            <select name="patient" id="patient" class="ml-2 px-2 py-1 rounded border border-gray-300">
                <option value="">All</option>
                {% for p in patient_list %}
                <option value="{{ p }}" {% if patient == p %}selected{% endif %}>{{ p }}</option>
                {% endfor %}
            </select>
        </div>
        <div>
            <label for="from_date" class="text-xs font-medium text-gray-700">From:</label>
            <input type="date" name="from_date" id="from_date" class="ml-2 px-2 py-1 rounded border border-gray-300" value="{{ from_date }}">
        </div>
        <div>
            <label for="to_date" class="text-xs font-medium text-gray-700">To:</label>
            <input type="date" name="to_date" id="to_date" class="ml-2 px-2 py-1 rounded border border-gray-300" value="{{ to_date }}">
        </div>
        <input type="hidden" name="sort" value="{{ sort }}">
        <button type="submit" class="px-3 py-2 rounded bg-indigo-600 text-white text-xs font-semibold">Filter</button>
    </form>
    <table class="min-w-full divide-y divide-gray-200">
        <thead class="bg-gray-50">
            <tr>
                <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">
                    Date
                    <a href="{{ url_for('main.sessions', sort='asc' if sort == 'desc' else 'desc', doctor=doctor, patient=patient) }}" class="ml-2 text-xs text-indigo-600 hover:text-indigo-900">
                        {% if sort == 'desc' %}
                            ▲
                        {% else %}
                            ▼
                        {% endif %}
                    </a>
                </th>
                <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Hour</th>
                <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Medic (User)</th>
                <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Patient Name</th>
                <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Total Amount</th>
                <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Payment Status</th>
                <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Actions</th>
            </tr>
        </thead>
        <tbody class="bg-white divide-y divide-gray-200">
                {% for session in sessions %}
                <tr>
                    <td class="px-4 py-2 whitespace-nowrap">{{ session.session_date.strftime('%Y-%m-%d') }}</td>
                    <td class="px-4 py-2 whitespace-nowrap">{{ session.session_time.strftime('%H:%M') }}</td>
                    <td class="px-4 py-2 whitespace-nowrap">{{ session.doctor_email }}</td>
                    <td class="px-4 py-2 whitespace-nowrap">{{ session.patient_full_name }}</td>
                    <td class="px-4 py-2 whitespace-nowrap">{{ session.total_amount or '' }}</td>
                    <td class="px-4 py-2 whitespace-nowrap">
                        <span
                            class="inline-block px-2 py-1 rounded {{ 'bg-green-100 text-green-800' if session.payment_status == 'paid' else 'bg-red-100 text-red-800' }}">
                            {{ session.payment_status|capitalize }}
                        </span>
                    </td>
                    <td class="px-4 py-2 whitespace-nowrap">
                        <a href="{{ url_for('main.edit_session', session_id=session.id) }}"
                            class="text-indigo-600 hover:text-indigo-900 font-medium">Edit</a>
                    </td>
                </tr>
                {% else %}
                <tr>
                    <td colspan="7" class="px-4 py-2 text-center text-gray-500">No sessions found.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock dashboard_content %}